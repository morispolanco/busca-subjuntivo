import streamlit as st
import pandas as pd
import plotly.express as px
import re

# Configuraci√≥n de la p√°gina
st.set_page_config(page_title="üîç Subjuntivo Finder (Completo)", layout="wide")
st.title("üîç Buscador de Verbos en Modo Subjuntivo")
st.markdown("""
Esta app detecta **todas las formas verbales en modo subjuntivo** en un texto en espa√±ol,
usando una base de datos completa de conjugaciones.
""")

# === BASE DE DATOS COMPLETA DE FORMAS EN SUBJUNTIVO ===
SUBJUNTIVO_COMPLETO = {
    # -----------------------------------------------------------------------
    # VERBOS REGULARES
    # -----------------------------------------------------------------------

    # -AR
    "hable": "hablar", "hables": "hablar", "hable": "hablar", "hablemos": "hablar", "habl√©is": "hablar", "hablen": "hablar",
    "hablara": "hablar", "hablaras": "hablar", "hablara": "hablar", "habl√°ramos": "hablar", "hablarais": "hablar", "hablaran": "hablar",
    "hablase": "hablar", "hablases": "hablar", "hablase": "hablar", "habl√°semos": "hablar", "hablaseis": "hablar", "hablasen": "hablar",
    "hablare": "hablar", "hablares": "hablar", "hablare": "hablar", "habl√°remos": "hablar", "hablareis": "hablar", "hablaren": "hablar",

    # -ER
    "coma": "comer", "comas": "comer", "coma": "comer", "comamos": "comer", "com√°is": "comer", "coman": "comer",
    "comiera": "comer", "comieras": "comer", "comiera": "comer", "comi√©ramos": "comer", "comierais": "comer", "comieran": "comer",
    "comiese": "comer", "comieses": "comer", "comiese": "comer", "comi√©semos": "comer", "comieseis": "comer", "comiesen": "comer",
    "comiere": "comer", "comieres": "comer", "comiere": "comer", "comi√©remos": "comer", "comiereis": "comer", "comieren": "comer",

    # -IR
    "viva": "vivir", "vivas": "vivir", "viva": "vivir", "vivamos": "vivir", "viv√°is": "vivir", "vivan": "vivir",
    "viviera": "vivir", "vivieras": "vivir", "viviera": "vivir", "vivi√©ramos": "vivir", "vivierais": "vivir", "vivieran": "vivir",
    "viviese": "vivir", "vivieses": "vivir", "viviese": "vivir", "vivi√©semos": "vivir", "vivieseis": "vivir", "viviesen": "vivir",
    "viviere": "vivir", "vivieres": "vivir", "viviere": "vivir", "vivi√©remos": "vivir", "viviereis": "vivir", "vivieren": "vivir",

    # -----------------------------------------------------------------------
    # VERBOS IRREGULARES Y ESPECIALES
    # -----------------------------------------------------------------------

    # SER
    "sea": "ser", "seas": "ser", "sea": "ser", "seamos": "ser", "se√°is": "ser", "sean": "ser",
    "fuera": "ser", "fueras": "ser", "fuera": "ser", "fu√©ramos": "ser", "fuerais": "ser", "fueran": "ser",
    "fuese": "ser", "fueses": "ser", "fuese": "ser", "fu√©semos": "ser", "fueseis": "ser", "fuesen": "ser",
    "fuere": "ser", "fueres": "ser", "fuere": "ser", "fu√©remos": "ser", "fuereis": "ser", "fueren": "ser",

    # ESTAR
    "est√©": "estar", "est√©s": "estar", "est√©": "estar", "estemos": "estar", "est√©is": "estar", "est√©n": "estar",
    "estuviera": "estar", "estuvieras": "estar", "estuviera": "estar", "estuvi√©ramos": "estar", "estuvierais": "estar", "estuvieran": "estar",
    "estuviese": "estar", "estuvieses": "estar", "estuviese": "estar", "estuvi√©semos": "estar", "estuvieseis": "estar", "estuviesen": "estar",
    "estuviere": "estar", "estuvieres": "estar", "estuviere": "estar", "estuvi√©remos": "estar", "estuviereis": "estar", "estuvieren": "estar",

    # HABER
    "haya": "haber", "hayas": "haber", "haya": "haber", "hayamos": "haber", "hay√°is": "haber", "hayan": "haber",
    "hubiera": "haber", "hubieras": "haber", "hubiera": "haber", "hubi√©ramos": "haber", "hubierais": "haber", "hubieran": "haber",
    "hubiese": "haber", "hubieses": "haber", "hubiese": "haber", "hubi√©semos": "haber", "hubieseis": "haber", "hubiesen": "haber",
    "hubiere": "haber", "hubieres": "haber", "hubiere": "haber", "hubi√©remos": "haber", "hubiereis": "haber", "hubieren": "haber",

    # IR
    "vaya": "ir", "vayas": "ir", "vaya": "ir", "vayamos": "ir", "vay√°is": "ir", "vayan": "ir",
    "fuera": "ir", "fueras": "ir", "fuera": "ir", "fu√©ramos": "ir", "fuerais": "ir", "fueran": "ir",
    "fuese": "ir", "fueses": "ir", "fuese": "ir", "fu√©semos": "ir", "fueseis": "ir", "fuesen": "ir",
    "fuere": "ir", "fueres": "ir", "fuere": "ir", "fu√©remos": "ir", "fuereis": "ir", "fueren": "ir",

    # DAR
    "d√©": "dar", "des": "dar", "d√©": "dar", "demos": "dar", "deis": "dar", "den": "dar",
    "diera": "dar", "dieras": "dar", "diera": "dar", "di√©ramos": "dar", "dierais": "dar", "dieran": "dar",
    "diese": "dar", "dieses": "dar", "diese": "dar", "di√©semos": "dar", "dieseis": "dar", "diesen": "dar",
    "diere": "dar", "dieres": "dar", "diere": "dar", "di√©remos": "dar", "diereis": "dar", "dieren": "dar",

    # SABER
    "sepa": "saber", "sepas": "saber", "sepa": "saber", "sepamos": "saber", "sep√°is": "saber", "sepan": "saber",
    "supiera": "saber", "supieras": "saber", "supiera": "saber", "supi√©ramos": "saber", "supierais": "saber", "supieran": "saber",
    "supiese": "saber", "supieses": "saber", "supiese": "saber", "supi√©semos": "saber", "supieseis": "saber", "supiesen": "saber",
    "supiere": "saber", "supieres": "saber", "supiere": "saber", "supi√©remos": "saber", "supiereis": "saber", "supieren": "saber",

    # PODER
    "pueda": "poder", "puedas": "poder", "pueda": "poder", "podamos": "poder", "pod√°is": "poder", "puedan": "poder",
    "pudiera": "poder", "pudieras": "poder", "pudiera": "poder", "pudi√©ramos": "poder", "pudierais": "poder", "pudieran": "poder",
    "pudiese": "poder", "pudieses": "poder", "pudiese": "poder", "pudi√©semos": "poder", "pudieseis": "poder", "pudiesen": "poder",
    "pudiere": "poder", "pudieres": "poder", "pudiere": "poder", "pudi√©remos": "poder", "pudiereis": "poder", "pudieren": "poder",

    # QUERER
    "quiera": "querer", "quieras": "querer", "quiera": "querer", "queramos": "querer", "quer√°is": "querer", "quieran": "querer",
    "quisiera": "querer", "quisieras": "querer", "quisiera": "querer", "quisi√©ramos": "querer", "quisierais": "querer", "quisieran": "querer",
    "quisiese": "querer", "quisieses": "querer", "quisiese": "querer", "quisi√©semos": "querer", "quisieseis": "querer", "quisiesen": "querer",
    "quisiere": "querer", "quisieres": "querer", "quisiere": "querer", "quisi√©remos": "querer", "quisiereis": "querer", "quisieren": "querer",

    # HACER
    "haga": "hacer", "hagas": "hacer", "haga": "hacer", "hagamos": "hacer", "hag√°is": "hacer", "hagan": "hacer",
    "hiciera": "hacer", "hicieras": "hacer", "hiciera": "hacer", "hici√©ramos": "hacer", "hicierais": "hacer", "hicieran": "hacer",
    "hiciese": "hacer", "hicieses": "hacer", "hiciese": "hacer", "hici√©semos": "hacer", "hicieseis": "hacer", "hiciesen": "hacer",
    "hicere": "hacer", "hiceres": "hacer", "hicere": "hacer", "hici√©remos": "hacer", "hicereis": "hacer", "hiceren": "hacer",

    # DECIR
    "diga": "decir", "digas": "decir", "diga": "decir", "digamos": "decir", "dig√°is": "decir", "digan": "decir",
    "dijera": "decir", "dijeras": "decir", "dijera": "decir", "dij√©ramos": "decir", "dijerais": "decir", "dijeran": "decir",
    "dijese": "decir", "dijeses": "decir", "dijese": "decir", "dij√©semos": "decir", "dijeseis": "decir", "dijesen": "decir",
    "dijere": "decir", "dijeres": "decir", "dijere": "decir", "dij√©remos": "decir", "dijereis": "decir", "dijeren": "decir",

    # VENIR
    "venga": "venir", "vengas": "venir", "venga": "venir", "vengamos": "venir", "veng√°is": "venir", "vengan": "venir",
    "viniera": "venir", "vinieras": "venir", "viniera": "venir", "vini√©ramos": "venir", "vinierais": "venir", "vinieran": "venir",
    "viniese": "venir", "vinieses": "venir", "viniese": "venir", "vini√©semos": "venir", "vinieseis": "venir", "viniesen": "venir",
    "viniere": "venir", "vinieres": "venir", "viniere": "venir", "vini√©remos": "venir", "viniereis": "venir", "vinieren": "venir",

    # PONER
    "ponga": "poner", "pongas": "poner", "ponga": "poner", "pongamos": "poner", "pong√°is": "poner", "pongan": "poner",
    "pusiera": "poner", "pusieras": "poner", "pusiera": "poner", "pusi√©ramos": "poner", "pusierais": "poner", "pusieran": "poner",
    "pusiese": "poner", "pusieses": "poner", "pusiese": "poner", "pusi√©semos": "poner", "pusieseis": "poner", "pusiesen": "poner",
    "pusiere": "poner", "pusieres": "poner", "pusiere": "poner", "pusi√©remos": "poner", "pusiereis": "poner", "pusieren": "poner",

    # SALIR
    "salga": "salir", "salgas": "salir", "salga": "salir", "salgamos": "salir", "salg√°is": "salir", "salgan": "salir",
    "saliera": "salir", "salieras": "salir", "saliera": "salir", "sali√©ramos": "salir", "salierais": "salir", "salieran": "salir",
    "saliese": "salir", "salieses": "salir", "saliese": "salir", "sali√©semos": "salir", "salieseis": "salir", "saliesen": "salir",
    "salieres": "salir", "salieres": "salir", "salieres": "salir", "sali√©remos": "salir", "salieres": "salir", "salieres": "salir",

    # TRAER
    "traiga": "traer", "traigas": "traer", "traiga": "traer", "traigamos": "traer", "traig√°is": "traer", "traigan": "traer",
    "trajera": "traer", "trajeras": "traer", "trajera": "traer", "traj√©ramos": "traer", "trajerais": "traer", "trajeran": "traer",
    "trajese": "traer", "trajeses": "traer", "trajese": "traer", "traj√©semos": "traer", "trajeseis": "traer", "trajesen": "traer",
    "trajere": "traer", "trajeres": "traer", "trajere": "traer", "traj√©remos": "traer", "trajereis": "traer", "trajeren": "traer",

    # VALER
    "valga": "valer", "valgas": "valer", "valga": "valer", "valgamos": "valer", "valg√°is": "valer", "valgan": "valer",
    "valiera": "valer", "valieras": "valer", "valiera": "valer", "vali√©ramos": "valer", "valierais": "valer", "valieran": "valer",
    "valiese": "valer", "valieses": "valer", "valiese": "valer", "vali√©semos": "valer", "valieseis": "valer", "valiesen": "valer",
    "valiere": "valer", "valieres": "valer", "valiere": "valer", "vali√©remos": "valer", "valiereis": "valer", "valieren": "valer",

    # MOVER
    "mueva": "mover", "muevas": "mover", "mueva": "mover", "movamos": "mover", "mov√°is": "mover", "muevan": "mover",
    "moviera": "mover", "movieras": "mover", "moviera": "mover", "movi√©ramos": "mover", "movierais": "mover", "movieran": "mover",
    "moviese": "mover", "movieses": "mover", "moviese": "mover", "movi√©semos": "mover", "movieseis": "mover", "moviesen": "mover",
    "moviere": "mover", "movieres": "mover", "moviere": "mover", "movi√©remos": "mover", "moviereis": "mover", "movieren": "mover",

    # O√çR
    "oiga": "o√≠r", "oigas": "o√≠r", "oiga": "o√≠r", "oigamos": "o√≠r", "oig√°is": "o√≠r", "oigan": "o√≠r",
    "oyera": "o√≠r", "oyeran": "o√≠r", "oyera": "o√≠r", "oy√©ramos": "o√≠r", "oyeran": "o√≠r", "oyeran": "o√≠r",
    "oyese": "o√≠r", "oyses": "o√≠r", "oyese": "o√≠r", "oy√©semos": "o√≠r", "oyeseis": "o√≠r", "oysen": "o√≠r",
    "oyere": "o√≠r", "oyeres": "o√≠r", "oyere": "o√≠r", "oy√©remos": "o√≠r", "oyereis": "o√≠r", "oyeren": "o√≠r",

    # CUBRIR
    "cubra": "cubrir", "cubras": "cubrir", "cubra": "cubrir", "cubramos": "cubrir", "cubr√°is": "cubrir", "cubran": "cubrir",
    "cubriera": "cubrir", "cubrieras": "cubrir", "cubriera": "cubrir", "cubri√©ramos": "cubrir", "cubrieras": "cubrir", "cubrieran": "cubrir",
    "cubriese": "cubrir", "cubrieses": "cubrir", "cubriese": "cubrir", "cubri√©semos": "cubrir", "cubrieseis": "cubrir", "cubriesen": "cubrir",
    "cubriere": "cubrir", "cubrieres": "cubrir", "cubriere": "cubrir", "cubri√©remos": "cubrir", "cubriereis": "cubrir", "cubrieren": "cubrir",

    # CABER
    "quepa": "caber", "quepas": "caber", "quepa": "caber", "quepamos": "caber", "quep√°is": "caber", "quepan": "caber",
    "cupiera": "caber", "cupieras": "caber", "cupiera": "caber", "cupi√©ramos": "caber", "cupieras": "caber", "cupieran": "caber",
    "cupiese": "caber", "cupieses": "caber", "cupiese": "caber", "cupi√©semos": "caber", "cupieseis": "caber", "cupiesen": "caber",
    "cupiere": "caber", "cupieres": "caber", "cupiere": "caber", "cupi√©remos": "caber", "cupiereis": "caber", "cupieren": "caber",

    # CONVENIR
    "convenza": "convencer", "convenzas": "convencer", "convenza": "convencer", "convenzamos": "convencer", "convenz√°is": "convencer", "convenzan": "convencer",
    "conviniere": "convencer", "conviniere": "convencer", "conviniere": "convencer", "convini√©ramos": "convencer", "conviniereis": "convencer", "conviniere": "convencer",

    # DORMIR
    "duerma": "dormir", "duermas": "dormir", "duerma": "dormir", "durmamos": "dormir", "durm√°is": "dormir", "duerman": "dormir",
    "durmiera": "dormir", "durmieras": "dormir", "durmiera": "dormir", "durmi√©ramos": "dormir", "durmieras": "dormir", "durmieran": "dormir",
    "durmiese": "dormir", "durmieses": "dormir", "durmiese": "dormir", "durmi√©semos": "dormir", "durmieseis": "dormir", "durmiesen": "dormir",
    "durmieres": "dormir", "durmieres": "dormir", "durmieres": "dormir", "durmi√©remos": "dormir", "durmieres": "dormir", "durmieres": "dormir",

    # PEDIR
    "pida": "pedir", "pidas": "pedir", "pida": "pedir", "pidamos": "pedir", "pid√°is": "pedir", "pidan": "pedir",
    "pidiera": "pedir", "pidieras": "pedir", "pidiera": "pedir", "pidi√©ramos": "pedir", "pidieras": "pedir", "pidieran": "pedir",
    "pidiese": "pedir", "pidieses": "pedir", "pidiese": "pedir", "pidi√©semos": "pedir", "pidieseis": "pedir", "pidiesen": "pedir",
    "pidiere": "pedir", "pidieres": "pedir", "pidiere": "pedir", "pidi√©remos": "pedir", "pidiereis": "pedir", "pidieren": "pedir",

    # SENTIR
    "sienta": "sentir", "sientas": "sentir", "sienta": "sentir", "sintamos": "sentir", "sint√°is": "sentir", "sientan": "sentir",
    "sintiera": "sentir", "sintieras": "sentir", "sintiera": "sentir", "sinti√©ramos": "sentir", "sintieras": "sentir", "sintieran": "sentir",
    "sintiese": "sentir", "sintieses": "sentir", "sintiese": "sentir", "sinti√©semos": "sentir", "sintieseis": "sentir", "sintiesen": "sentir",
    "sintiere": "sentir", "sintieres": "sentir", "sintiere": "sentir", "sinti√©remos": "sentir", "sintiereis": "sentir", "sintieren": "sentir",

    # RE√çR
    "r√≠a": "re√≠r", "r√≠as": "re√≠r", "r√≠a": "re√≠r", "riamos": "re√≠r", "ri√°is": "re√≠r", "r√≠an": "re√≠r",
    "riera": "re√≠r", "rieras": "re√≠r", "riera": "re√≠r", "ri√©ramos": "re√≠r", "rieras": "re√≠r", "rieran": "re√≠r",
    "riese": "re√≠r", "rieses": "re√≠r", "riese": "re√≠r", "ri√©semos": "re√≠r", "rieseis": "re√≠r", "riesen": "re√≠r",
    "riere": "re√≠r", "rieres": "re√≠r", "riere": "re√≠r", "ri√©remos": "re√≠r", "riereis": "re√≠r", "rieren": "re√≠r",

    # LEER
    "lea": "leer", "leas": "leer", "lea": "leer", "leamos": "leer", "le√°is": "leer", "lean": "leer",
    "leyera": "leer", "leyeras": "leer", "leyera": "leer", "ley√©ramos": "leer", "leyeras": "leer", "leyeran": "leer",
    "leyese": "leer", "leyeses": "leer", "leyese": "leer", "ley√©semos": "leer", "leyeseis": "leer", "leyesen": "leer",
    "leyere": "leer", "leyeres": "leer", "leyere": "leer", "ley√©remos": "leer", "leyereis": "leer", "leyeren": "leer",

    # CAER
    "caiga": "caer", "caigas": "caer", "caiga": "caer", "caigamos": "caer", "caig√°is": "caer", "caigan": "caer",
    "cayera": "caer", "cayeras": "caer", "cayera": "caer", "cay√©ramos": "caer", "cayeras": "caer", "cayeran": "caer",
    "cayese": "caer", "cayeses": "caer", "cayese": "caer", "cay√©semos": "caer", "cayeseis": "caer", "cayesen": "caer",
    "cayere": "caer", "cayeres": "caer", "cayere": "caer", "cay√©remos": "caer", "cayereis": "caer", "cayeren": "caer",

    # ANDAR
    "ande": "andar", "andes": "andar", "ande": "andar", "andemos": "andar", "and√©is": "andar", "anden": "andar",
    "anduviera": "andar", "anduvieras": "andar", "anduviera": "andar", "anduvi√©ramos": "andar", "anduvieras": "andar", "anduvieran": "andar",
    "anduviese": "andar", "anduvieses": "andar", "anduviese": "andar", "anduvi√©semos": "andar", "anduvieseis": "andar", "anduviesen": "andar",
    "anduviere": "andar", "anduvieres": "andar", "anduviere": "andar", "anduvi√©remos": "andar", "anduviereis": "andar", "anduvieren": "andar",

    # TENER
    "tenga": "tener", "tengas": "tener", "tenga": "tener", "tengamos": "tener", "teng√°is": "tener", "tengan": "tener",
    "tuviera": "tener", "tuvieras": "tener", "tuviera": "tener", "tuvieran": "tener", "tuviera": "tener", "tuvieran": "tener",
    "tuviese": "tener", "tuvieses": "tener", "tuviese": "tener", "tuviese": "tener", "tuvieseis": "tener", "tuviesen": "tener",
    "tuviere": "tener", "tuvieres": "tener", "tuviere": "tener", "tuvi√©remos": "tener", "tuviereis": "tener", "tuvieren": "tener",

    # MANTENER
    "mantenga": "mantener", "mantengas": "mantener", "mantenga": "mantener", "mantengamos": "mantener", "manteng√°is": "mantener", "mantengan": "mantener",
    "mantuviera": "mantener", "mantuvieras": "mantener", "mantuviera": "mantener", "mantuvi√©ramos": "mantener", "mantuvieras": "mantener", "mantuvieran": "mantener",
    "mantuviese": "mantener", "mantuvieses": "mantener", "mantuviese": "mantener", "mantuvi√©semos": "mantener", "mantuvieseis": "mantener", "mantuviesen": "mantener",
    "mantuviere": "mantener", "mantuvieres": "mantener", "mantuviere": "mantener", "mantuvi√©remos": "mantener", "mantuviereis": "mantener", "mantuvieren": "mantener",

    # CONTENER
    "contenga": "contener", "contengas": "contener", "contenga": "contener", "contengamos": "contener", "conteng√°is": "contener", "contengan": "contener",
    "contuviera": "contener", "contuvieras": "contener", "contuviera": "contener", "contuvieran": "contener", "contuviera": "contener", "contuvieran": "contener",
    "contuviese": "contener", "contuvieses": "contener", "contuviese": "contener", "contuviese": "contener", "contuvieseis": "contener", "contuviesen": "contener",
    "contuviere": "contener", "contuvieres": "contener", "contuviere": "contener", "contuvi√©remos": "contener", "contuviereis": "contener", "contuvieren": "contener",

    # ENTENDER
    "entienda": "entender", "entiendas": "entender", "entienda": "entender", "entendamos": "entender", "entend√°is": "entender", "entiendan": "entender",
    "entendiera": "entender", "entendieras": "entender", "entendiera": "entender", "entendi√©ramos": "entender", "entendieras": "entender", "entendieran": "entender",
    "entendiese": "entender", "entendieses": "entender", "entendiese": "entender", "entendi√©semos": "entender", "entendieseis": "entender", "entendiesen": "entender",
    "entendiere": "entender", "entendieres": "entender", "entendiere": "entender", "entendi√©remos": "entender", "entendiereis": "entender", "entendieren": "entender",

    # HUIR
    "huya": "huir", "huyas": "huir", "huya": "huir", "huyamos": "huir", "huy√°is": "huir", "huyan": "huir",
    "huyera": "huir", "huyeras": "huir", "huyera": "huir", "huy√©ramos": "huir", "huyeras": "huir", "huyeran": "huir",
    "huyese": "huir", "huyeses": "huir", "huyese": "huir", "huy√©semos": "huir", "huyeseis": "huir", "huyesen": "huir",
    "huyere": "huir", "huyeres": "huir", "huyere": "huir", "huy√©remos": "huir", "huyereis": "huir", "huyeren": "huir",

    # CONSTRUIR
    "construya": "construir", "construyas": "construir", "construya": "construir", "construyamos": "construir", "construy√°is": "construir", "construyan": "construir",
    "construyera": "construir", "construyeras": "construir", "construyera": "construir", "construy√©ramos": "construir", "construyeras": "construir", "construyeran": "construir",
    "construyese": "construir", "construyeses": "construir", "construyese": "construir", "construy√©semos": "construir", "construyeseis": "construir", "construyesen": "construir",
    "construyere": "construir", "construyeres": "construir", "construyere": "construir", "construy√©remos": "construir", "construyereis": "construir", "construyeren": "construir",

    # ADQUIRIR
    "adquiera": "adquirir", "adquieras": "adquirir", "adquiera": "adquirir", "adquiramos": "adquirir", "adquir√°is": "adquirir", "adquieran": "adquirir",
    "adquiriera": "adquirir", "adquirieras": "adquirir", "adquiriera": "adquirir", "adquiri√©ramos": "adquirir", "adquirieras": "adquirir", "adquirieran": "adquirir",
    "adquiriese": "adquirir", "adquierieses": "adquirir", "adquiriese": "adquirir", "adquiri√©semos": "adquirir", "adquirieseis": "adquirir", "adquieriesen": "adquirir",
    "adquiriere": "adquirir", "adquierieres": "adquirir", "adquiriere": "adquirir", "adquiri√©remos": "adquirir", "adquiriereis": "adquirir", "adquirieren": "adquirir",

    # INCLUIR
    "incluya": "incluir", "incluyas": "incluir", "incluya": "incluir", "incluyamos": "incluir", "incluy√°is": "incluir", "incluyan": "incluir",
    "incluyera": "incluir", "incluyeras": "incluir", "incluyera": "incluir", "incluy√©ramos": "incluir", "incluyeras": "incluir", "incluyeran": "incluir",
    "incluyese": "incluir", "incluyeses": "incluir", "incluyese": "incluir", "incluy√©semos": "incluir", "incluyeseis": "incluir", "incluyesen": "incluir",
    "incluyere": "incluir", "incluyeres": "incluir", "incluyere": "incluir", "incluy√©remos": "incluir", "incluyereis": "incluir", "incluyeren": "incluir",

    # ATRIBUIR
    "atribuya": "atribuir", "atribuyas": "atribuir", "atribuya": "atribuir", "atribuyamos": "atribuir", "atribuy√°is": "atribuir", "atribuyan": "atribuir",
    "atribuyera": "atribuir", "atribuyeras": "atribuir", "atribuyera": "atribuir", "atribuy√©ramos": "atribuir", "atribuyeras": "atribuir", "atribuyeran": "atribuir",
    "atribuyese": "atribuir", "atribuyeses": "atribuir", "atribuyese": "atribuir", "atribuy√©semos": "atribuir", "atribuyeseis": "atribuir", "atribuyesen": "atribuir",
    "atribuyere": "atribuir", "atribuyeres": "atribuir", "atribuyere": "atribuir", "atribuy√©remos": "atribuir", "atribuyereis": "atribuir", "atribuyeren": "atribuir",

    # PROVEER
    "provea": "proveer", "proveas": "proveer", "provea": "proveer", "proveamos": "proveer", "prove√°is": "proveer", "provean": "proveer",
    "proveyera": "proveer", "proveyeras": "proveer", "proveyera": "proveer", "provey√©ramos": "proveer", "proveyeras": "proveer", "proveyeran": "proveer",
    "proveyese": "proveer", "proveyeses": "proveer", "proveyese": "proveer", "provey√©semos": "proveer", "proveyeseis": "proveer", "proveyesen": "proveer",
    "proveyere": "proveer", "proveyeres": "proveer", "proveyere": "proveer", "provey√©remos": "proveer", "proveyereis": "proveer", "proveyeren": "proveer",

    # DESLEER
    "deslea": "desleer", "desleas": "desleer", "deslea": "desleer", "desleamos": "desleer", "desle√°is": "desleer", "deslean": "desleer",
    "desleyera": "desleer", "desleyeras": "desleer", "desleyera": "desleer", "desley√©ramos": "desleer", "desleyeras": "desleer", "desleyeran": "desleer",
    "desleyese": "desleer", "desleyeses": "desleer", "desleyese": "desleer", "desley√©semos": "desleer", "desleyeseis": "desleer", "desleyesen": "desleer",
    "desleyere": "desleer", "desleyeres": "desleer", "desleyere": "desleer", "desley√©remos": "desleer", "desleyereis": "desleer", "desleyeren": "desleer",

    # ENTREVER
    "entrevea": "entrever", "entreveas": "entrever", "entrevea": "entrever", "entreveamos": "entrever", "entreve√°is": "entrever", "entrevean": "entrever",
    "entreviera": "entrever", "entrevieras": "entrever", "entreviera": "entrever", "entrevi√©ramos": "entrever", "entrevieras": "entrever", "entrevieran": "entrever",
    "entreviese": "entrever", "entrevieses": "entrever", "entreviese": "entrever", "entrevi√©semos": "entrever", "entrevieseis": "entrever", "entreviesen": "entrever",
    "entreviere": "entrever", "entrevieres": "entrever", "entreviere": "entrever", "entrevi√©remos": "entrever", "entreviereis": "entrever", "entrevieren": "entrever",

    # CUMPLIR
    "cumpla": "cumplir", "cumplas": "cumplir", "cumpla": "cumplir", "cumplamos": "cumplir", "cumpl√°is": "cumplir", "cumplan": "cumplir",
    "cumpliera": "cumplir", "cumplieras": "cumplir", "cumpliera": "cumplir", "cumpli√©ramos": "cumplir", "cumplieras": "cumplir", "cumplieran": "cumplir",
    "cumpliese": "cumplir", "cumplieses": "cumplir", "cumpliese": "cumplir", "cumpli√©semos": "cumplir", "cumplieseis": "cumplir", "cumpliesen": "cumplir",
    "cumpliere": "cumplir", "cumplieres": "cumplir", "cumpliere": "cumplir", "cumpli√©remos": "cumplir", "cumpliereis": "cumplir", "cumplieren": "cumplir",

    # SONRE√çR
    "sonr√≠a": "sonre√≠r", "sonr√≠as": "sonre√≠r", "sonr√≠a": "sonre√≠r", "sonriamos": "sonre√≠r", "sonri√°is": "sonre√≠r", "sonr√≠an": "sonre√≠r",
    "sonriera": "sonre√≠r", "sonrieras": "sonre√≠r", "sonriera": "sonre√≠r", "sonri√©ramos": "sonre√≠r", "sonrieras": "sonre√≠r", "sonrieran": "sonre√≠r",
    "sonriese": "sonre√≠r", "sonrieses": "sonre√≠r", "sonriese": "sonre√≠r", "sonri√©semos": "sonre√≠r", "sonrieseis": "sonre√≠r", "sonriesen": "sonre√≠r",
    "sonriere": "sonre√≠r", "sonrieres": "sonre√≠r", "sonriere": "sonre√≠r", "sonri√©remos": "sonre√≠r", "sonriereis": "sonre√≠r", "sonrieren": "sonre√≠r",

    # DESO√çR
    "desoiga": "deso√≠r", "desoigas": "deso√≠r", "desoiga": "deso√≠r", "desoigamos": "deso√≠r", "desoig√°is": "deso√≠r", "desoigan": "deso√≠r",
    "desoyera": "deso√≠r", "desoyeran": "deso√≠r", "desoyera": "deso√≠r", "desoy√©ramos": "deso√≠r", "desoyeran": "deso√≠r", "desoyeran": "deso√≠r",
    "desoyese": "deso√≠r", "desoyses": "deso√≠r", "desoyese": "deso√≠r", "desoy√©semos": "deso√≠r", "desoyeseis": "deso√≠r", "desoysen": "deso√≠r",
    "desoyere": "deso√≠r", "desoyeres": "deso√≠r", "desoyere": "deso√≠r", "desoy√©remos": "deso√≠r", "desoyereis": "deso√≠r", "desoyeren": "deso√≠r",

    # PERCIBIR
    "perciba": "percibir", "percibas": "percibir", "perciba": "percibir", "percibamos": "percibir", "percib√°is": "percibir", "perciban": "percibir",
    "percibiera": "percibir", "percibieras": "percibir", "percibiera": "percibir", "percibi√©ramos": "percibir", "percibieras": "percibir", "percibieran": "percibir",
    "percibiese": "percibir", "percibieses": "percibir", "percibiese": "percibir", "percibi√©semos": "percibir", "percibieseis": "percibir", "percibiesen": "percibir",
    "percibiere": "percibir", "percibieres": "percibir", "percibiere": "percibir", "percibi√©remos": "percibir", "percibiereis": "percibir", "percibieren": "percibir",

    # ELEGIR
    "elija": "elegir", "elijas": "elegir", "elija": "elegir", "elijamos": "elegir", "elij√°is": "elegir", "elijan": "elegir",
    "eligiera": "elegir", "eligieras": "elegir", "eligiera": "elegir", "eligieran": "elegir", "eligiera": "elegir", "eligieran": "elegir",
    "eligiese": "elegir", "eligieses": "elegir", "eligiese": "elegir", "eligiese": "elegir", "eligieseis": "elegir", "eligiesen": "elegir",
    "eligiere": "elegir", "eligieres": "elegir", "eligiere": "elegir", "eligi√©remos": "elegir", "eligiereis": "elegir", "eligieren": "elegir",

    # ESCOGER
    "escoja": "escoger", "escojas": "escoger", "escoja": "escoger", "escojamos": "escoger", "escoj√°is": "escoger", "escojan": "escoger",
    "escogiera": "escoger", "escogieras": "escoger", "escogiera": "escoger", "escogi√©ramos": "escoger", "escogieras": "escoger", "escogieran": "escoger",
    "escogiese": "escoger", "escogieses": "escoger", "escogiese": "escoger", "escogi√©semos": "escoger", "escogieseis": "escoger", "escogiesen": "escoger",
    "escogiere": "escoger", "escogieres": "escoger", "escogiere": "escoger", "escogi√©remos": "escoger", "escogiereis": "escoger", "escogieren": "escoger",
}

# Conjunto para b√∫squedas r√°pidas
SUBJ_SET = set(SUBJUNTIVO_COMPLETO.keys()

def detectar_subjuntivo(texto):
    palabras = re.findall(r'\b\w+\b', texto, re.IGNORECASE)
    encontrados = []
    vistos = set()
    for palabra in palabras:
        forma = palabra.lower()
        if forma in SUBJ_SET and forma not in vistos:
            lema = SUBJUNTIVO_COMPLETO[forma]
            # Tiempo
            if forma.endswith(("ra", "se", "ramos", "semos", "rais", "seis", "ran", "sen")):
                tiempo = "Imperfecto"
            elif forma.endswith("re"):
                tiempo = "Futuro"
            else:
                tiempo = "Presente"
            # N√∫mero
            numero = "Plural" if forma.endswith(("mos", "is", "n", "√°is", "ais")) else "Singular"
            # Persona (aproximada)
            persona = {
                "o": "1¬™", "as": "2¬™", "a": "3¬™", "amos": "1¬™", "√°is": "2¬™", "is": "2¬™", "n": "3¬™"
            }.get(forma[-2:], "Desconocida") if len(forma) > 2 else "Desconocida"

            encontrados.append({
                "Verbo": palabra,
                "Lema": lema,
                "Tiempo": tiempo,
                "Modo": "Subjuntivo",
                "Persona": persona,
                "N√∫mero": numero
            })
            vistos.add(forma)
    return encontrados

# --- Interfaz ---
uploaded_file = st.file_uploader("üì§ Sube tu archivo .txt", type=["txt"])

if uploaded_file is not None:
    try:
        texto = uploaded_file.read().decode("utf-8")
        st.success("‚úÖ Archivo cargado.")

        with st.expander("üìÑ Ver texto"):
            st.text(texto)

        # Analizar
        verbos = detectar_subjuntivo(texto)

        if verbos:
            df = pd.DataFrame(verbos)
            st.subheader(f"üéâ Se encontraron {len(df)} verbos en subjuntivo")

            tab1, tab2, tab3 = st.tabs(["üìä Estad√≠sticas", "üìÑ Texto resaltado", "üìã Detalles"])

            with tab1:
                col1, col2 = st.columns(2)
                with col1:
                    fig1 = px.pie(df, names="Tiempo", title="Tiempo verbal")
                    st.plotly_chart(fig1)
                with col2:
                    fig2 = px.pie(df, names="Lema", title="Verbos m√°s usados")
                    st.plotly_chart(fig2)

            with tab2:
                highlighted = texto
                for v in sorted(df["Verbo"].unique(), key=len, reverse=True):
                    highlighted = re.sub(
                        rf'\b({re.escape(v)})\b',
                        f'<mark style="background: #FFEB3B; padding: 2px 6px; border-radius: 4px; font-weight: bold;">\\1</mark>',
                        highlighted,
                        flags=re.IGNORECASE
                    )
                st.markdown(
                    f'<div style="line-height: 1.8; padding: 15px; background: #f8f9fa; border-radius: 8px;">{highlighted}</div>',
                    unsafe_allow_html=True
                )

            with tab3:
                st.dataframe(df, use_container_width=True)

            # Descarga CSV
            csv_data = df.to_csv(index=False).encode("utf-8")
            st.download_button(
                "‚¨áÔ∏è Descargar CSV",
                data=csv_data,
                file_name="verbos_subjuntivo.csv",
                mime="text/csv"
            )
        else:
            st.info("‚ÑπÔ∏è No se encontraron verbos en subjuntivo.")

    except Exception as e:
        st.error("‚ùå Error al procesar el archivo.")
        st.exception(e)
else:
    st.info("üëà Sube un archivo .txt para comenzar.")
